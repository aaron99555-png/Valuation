<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£†è‚¡èè‹±ç­ | æˆé•·æ½›åŠ›è‚¡ç ”ç©¶å®¤</title>
    
    <!-- å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- å¼•å…¥ Babel ç”¨æ–¼è§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- è‡ªå®šç¾© Tailwind è¨­å®šä»¥é…åˆåŸæœ¬çš„æš—é»‘é¢¨æ ¼ -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        neutral: {
                            850: '#1f1f1f',
                            950: '#0a0a0a',
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        /* è‡ªå®šç¾©æ»¾å‹•æ¢æ¨£å¼ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #171717; 
        }
        ::-webkit-scrollbar-thumb {
            background: #404040; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #525252; 
        }
        
        /* æ–‡å­—ç™¼å…‰ç‰¹æ•ˆ */
        .glow-text {
            text-shadow: 0 0 10px rgba(244, 63, 94, 0.5);
        }
        
        /* éœ“è™¹é‚Šæ¡†å‹•ç•« */
        @keyframes border-pulse {
            0% { border-color: rgba(59, 130, 246, 0.5); }
            50% { border-color: rgba(59, 130, 246, 1); }
            100% { border-color: rgba(59, 130, 246, 0.5); }
        }
        .animate-border-pulse {
            animation: border-pulse 2s infinite;
        }
    </style>
</head>
<body class="bg-black text-white">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // --- Icon Components (SVG) ---
        const Crown = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></svg>
        );
        const Zap = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
        );
        const DollarSign = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
        );
        const TrendingUp = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
        );
        const Flame = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/></svg>
        );
        const HelpCircle = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
        );
        const Info = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
        );
        const Table = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 3h7a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-7m0-18H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h7m0-18v18"/></svg>
        );
        const Search = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
        );
        const Target = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
        );

        // --- æ ¸å¿ƒè¨ˆç®—é‚è¼¯ ---
        const calculateDCF = (params) => {
            const currentValue = parseFloat(params.currentValue) || 0;
            const growthRate1_5 = parseFloat(params.growthRate1_5) || 0;
            const growthRate6_10 = parseFloat(params.growthRate6_10) || 0;
            const growthRateTerminal = parseFloat(params.growthRateTerminal) || 0;
            const discountRate = parseFloat(params.discountRate) || 0;
            const marginOfSafety = parseFloat(params.marginOfSafety) || 0;
            
            const currentPrice = parseFloat(params.currentPrice) || 0;
            const bookValue = parseFloat(params.bookValue) || 0;
            const estimatedEPS = parseFloat(params.estimatedEPS) || 0;
            const targetPE = parseFloat(params.targetPE) || 0;

            const g1 = growthRate1_5 / 100;
            const g2 = growthRate6_10 / 100;
            const gTerminal = growthRateTerminal / 100;
            const r = discountRate / 100;

            // ç›¸å°ä¼°å€¼è¨ˆç®—
            const peRatio = (currentPrice > 0 && currentValue > 0) ? (currentPrice / currentValue) : 0;
            const pegRatio = (peRatio > 0 && growthRate1_5 > 0) ? (peRatio / growthRate1_5) : 0;
            const pbRatio = (currentPrice > 0 && bookValue > 0) ? (currentPrice / bookValue) : 0;
            
            // ç›®æ¨™åƒ¹è©¦ç®— (Forward PE Method)
            const targetPricePE = estimatedEPS * targetPE;

            if (r <= gTerminal) return { isValid: false, intrinsicValue: 0 };

            let futureValues = [];
            let totalPresentValueStage1 = 0;
            let previousValue = currentValue;

            // 1-10 å¹´è¨ˆç®—
            for (let i = 1; i <= 10; i++) {
                let currentGrowthRate = i <= 5 ? g1 : g2;
                let stageName = i <= 5 ? 'é£†é€Ÿæˆé•·æœŸ (1-5å¹´)' : 'ç©©å¥éæ¸¡æœŸ (6-10å¹´)';
                
                const projectedValue = previousValue * (1 + currentGrowthRate);
                const discountFactor = 1 / Math.pow((1 + r), i);
                const presentValue = projectedValue * discountFactor;

                futureValues.push({
                    year: i,
                    stage: stageName,
                    growthRateUsed: (currentGrowthRate * 100),
                    projectedValue: projectedValue,
                    discountFactor: discountFactor,
                    presentValue: presentValue
                });

                totalPresentValueStage1 += presentValue;
                previousValue = projectedValue;
            }

            // çµ‚å€¼è¨ˆç®—
            const finalYearValue = futureValues[futureValues.length - 1].projectedValue;
            const terminalValue = (finalYearValue * (1 + gTerminal)) / (r - gTerminal);
            const terminalDiscountFactor = 1 / Math.pow((1 + r), 10);
            const terminalValuePV = terminalValue * terminalDiscountFactor;

            const intrinsicValue = totalPresentValueStage1 + terminalValuePV;
            const safetyPrice = intrinsicValue * (1 - marginOfSafety / 100);

            return {
                isValid: true,
                tableData: futureValues,
                terminalValue,
                terminalValuePV,
                totalPresentValueStage1,
                intrinsicValue,
                safetyPrice,
                finalYearValue,
                targetPricePE,
                multiples: {
                    peRatio,
                    pegRatio,
                    pbRatio
                }
            };
        };

        const TwoStageDCF = () => {
            const [showHelp, setShowHelp] = useState(false); 

            // é è¨­ç‚ºä¸­ç«‹æƒ…å¢ƒ
            const [inputs, setInputs] = useState({
                stockSymbol: '',        
                stockName: '',  
                currentPrice: '',       
                currentValue: 10,       
                bookValue: '',
                estimatedEPS: '',       // æ–°å¢ï¼šé ä¼° EPS
                targetPE: 20,           // æ–°å¢ï¼šåˆç†æœ¬ç›Šæ¯”
                growthRate1_5: 15,      
                growthRate6_10: 8,     
                growthRateTerminal: 3,  
                discountRate: 10,       
                marginOfSafety: 20,     
            });

            const calc = useMemo(() => calculateDCF(inputs), [inputs]);

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                let newInputs = { ...inputs, [name]: value };
                // ç§»é™¤è‡ªå‹•å¸¶å…¥é‚è¼¯
                setInputs(newInputs);
            };

            const applyScenario = (type) => {
                if (type === 'conservative') {
                    setInputs(prev => ({ 
                        ...prev, growthRate1_5: 8, growthRate6_10: 4, growthRateTerminal: 2, discountRate: 12, marginOfSafety: 30, targetPE: 15 
                    }));
                } else if (type === 'neutral') {
                    setInputs(prev => ({ 
                        ...prev, growthRate1_5: 15, growthRate6_10: 8, growthRateTerminal: 3, discountRate: 10, marginOfSafety: 20, targetPE: 20 
                    }));
                } else if (type === 'optimistic') {
                    setInputs(prev => ({ 
                        ...prev, growthRate1_5: 25, growthRate6_10: 15, growthRateTerminal: 3.5, discountRate: 9, marginOfSafety: 10, targetPE: 30 
                    }));
                }
            };

            const formatNum = (num) => num?.toLocaleString('zh-TW', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

            return (
                <div className="min-h-screen bg-neutral-950 font-sans text-gray-100 p-4 md:p-8 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-neutral-900 via-neutral-950 to-black">
                    <div className="max-w-7xl mx-auto">
                        
                        {/* Header */}
                        <header className="mb-8 border-b border-white/10 pb-6 flex flex-col md:flex-row md:items-center justify-between gap-6">
                            <div className="relative">
                                <div className="absolute -left-4 -top-4 w-16 h-16 bg-amber-500/20 blur-2xl rounded-full"></div>
                                <h1 className="text-3xl md:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-amber-300 via-orange-400 to-red-500 flex items-center gap-3 italic tracking-tight relative z-10">
                                    <Crown className="text-amber-400 fill-amber-400" size={32} />
                                    é£†è‚¡èè‹±ç­
                                    <span className="text-lg md:text-2xl not-italic font-bold text-neutral-500 flex items-center gap-1">
                                        | {inputs.stockSymbol || inputs.stockName ? `${inputs.stockSymbol} ${inputs.stockName}` : 'æˆé•·æ½›åŠ›è‚¡ç ”ç©¶å®¤'}
                                    </span>
                                </h1>
                                <p className="text-neutral-400 text-sm mt-2 ml-1 font-medium tracking-wide relative z-10">
                                    æŒæ¡å…§åœ¨åƒ¹å€¼ï¼Œç²¾æº–ç‹™æ“Šè²·é»
                                </p>
                            </div>
                            
                            {/* æƒ…å¢ƒæŒ‰éˆ• */}
                            <div className="flex bg-neutral-900/80 backdrop-blur-sm p-1.5 rounded-xl border border-white/10 shadow-2xl relative z-10">
                                <button onClick={() => applyScenario('conservative')} className="px-4 py-2 text-sm font-bold text-neutral-400 hover:text-white hover:bg-neutral-800 rounded-lg transition-all flex items-center gap-2 group">
                                    <span className="w-2 h-2 rounded-full bg-neutral-600 group-hover:bg-neutral-400"></span>ä¿å®ˆ
                                </button>
                                <div className="w-px bg-white/10 my-1 mx-1"></div>
                                <button onClick={() => applyScenario('neutral')} className="px-4 py-2 text-sm font-bold text-blue-400 hover:text-blue-300 hover:bg-blue-900/30 rounded-lg transition-all flex items-center gap-2 group">
                                    <span className="w-2 h-2 rounded-full bg-blue-500 group-hover:shadow-[0_0_10px_rgba(59,130,246,0.8)]"></span>ä¸­ç«‹
                                </button>
                                <div className="w-px bg-white/10 my-1 mx-1"></div>
                                <button onClick={() => applyScenario('optimistic')} className="px-4 py-2 text-sm font-bold text-amber-400 hover:text-amber-300 hover:bg-amber-900/30 rounded-lg transition-all flex items-center gap-2 group">
                                    <span className="w-2 h-2 rounded-full bg-amber-500 group-hover:shadow-[0_0_10px_rgba(245,158,11,0.8)] animate-pulse"></span>æ¨‚è§€
                                </button>
                            </div>
                        </header>

                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                            
                            {/* å·¦å´ï¼šè¼¸å…¥é¢æ¿ */}
                            <div className="lg:col-span-4 space-y-5">

                                {/* 0. é–å®šæ¨™çš„ (å«è‚¡åƒ¹) */}
                                <div className="bg-neutral-900/50 backdrop-blur-md p-6 rounded-2xl shadow-xl border border-white/5 relative overflow-hidden group">
                                    <h3 className="font-bold text-blue-400 mb-4 flex items-center gap-2 text-lg">
                                        <Search size={20} className="fill-blue-500/20" /> é–å®šæ¨™çš„
                                    </h3>
                                    <div className="space-y-4">
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-xs font-bold text-neutral-400 uppercase tracking-wider mb-2">è‚¡ç¥¨ä»£è™Ÿ</label>
                                                <input type="text" name="stockSymbol" value={inputs.stockSymbol} onChange={handleInputChange} className="w-full p-3 bg-black/40 border border-white/10 rounded-xl focus:ring-2 focus:ring-blue-500/50 outline-none text-white font-bold placeholder-neutral-700" placeholder="ex: 2330"/>
                                            </div>
                                            <div>
                                                <label className="block text-xs font-bold text-neutral-400 uppercase tracking-wider mb-2">è‚¡ç¥¨åç¨±</label>
                                                <input type="text" name="stockName" value={inputs.stockName} onChange={handleInputChange} className="w-full p-3 bg-black/40 border border-white/10 rounded-xl focus:ring-2 focus:ring-blue-500/50 outline-none text-white font-bold placeholder-neutral-700" placeholder="ex: å°ç©é›»"/>
                                            </div>
                                        </div>
                                        
                                        {/* ç›®å‰è‚¡åƒ¹ */}
                                        <div className="relative pt-2 border-t border-white/5">
                                             <label className="block text-xs font-bold text-neutral-400 uppercase tracking-wider mb-2">ç›®å‰å¸‚åƒ¹ (Price)</label>
                                             <div className="relative">
                                                <span className="absolute left-4 top-1/2 -translate-y-1/2 text-neutral-500 font-bold">$</span>
                                                <input type="number" name="currentPrice" value={inputs.currentPrice} onChange={handleInputChange} 
                                                    className="w-full pl-8 pr-4 py-3 bg-black/40 border border-white/10 rounded-xl focus:ring-2 focus:ring-blue-500/50 outline-none text-xl font-bold text-white placeholder-neutral-700" 
                                                    placeholder="è¼¸å…¥è‚¡åƒ¹ä»¥è¨ˆç®— PE/PB"
                                                />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                {/* 1. åŸºç¤æ•¸æ“š (å«æ·¨å€¼) */}
                                <div className="bg-neutral-900/50 backdrop-blur-md p-6 rounded-2xl shadow-xl border border-white/5 relative overflow-hidden group">
                                    <div className="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                                        <DollarSign size={80} className="text-emerald-500" />
                                    </div>
                                    <h3 className="font-bold text-emerald-400 mb-4 flex items-center gap-2 text-lg">
                                        <DollarSign size={20} className="fill-emerald-500/20" /> åŸºæœ¬é¢æ•¸æ“š
                                    </h3>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-xs font-bold text-neutral-400 uppercase tracking-wider mb-2">ä»Šå¹´ EPS / FCF</label>
                                            <div className="relative">
                                                <span className="absolute left-4 top-1/2 -translate-y-1/2 text-emerald-500 font-bold">$</span>
                                                <input type="number" name="currentValue" value={inputs.currentValue} onChange={handleInputChange} 
                                                    className="w-full pl-8 pr-4 py-3 bg-black/40 border border-white/10 rounded-xl focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500 outline-none text-2xl font-bold text-white placeholder-neutral-700 transition-all shadow-inner" 
                                                />
                                            </div>
                                        </div>
                                        
                                        {/* æ·¨å€¼è¼¸å…¥ */}
                                        <div>
                                            <label className="block text-xs font-bold text-neutral-400 uppercase tracking-wider mb-2">æ¯è‚¡æ·¨å€¼ (Book Value) <span className="text-neutral-600 font-normal normal-case">- é¸å¡«</span></label>
                                            <div className="relative">
                                                <span className="absolute left-4 top-1/2 -translate-y-1/2 text-neutral-600 font-bold">$</span>
                                                <input type="number" name="bookValue" value={inputs.bookValue} onChange={handleInputChange} 
                                                    className="w-full pl-8 pr-4 py-2 bg-black/40 border border-white/10 rounded-xl focus:ring-1 focus:ring-emerald-500/30 outline-none text-white font-medium placeholder-neutral-700" 
                                                    placeholder="ç”¨æ–¼è¨ˆç®— PB Ratio"
                                                />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* 2. æ–°å¢ï¼šç›®æ¨™åƒ¹è©¦ç®— (Forward Valuation) */}
                                <div className="bg-neutral-900/50 backdrop-blur-md p-6 rounded-2xl shadow-xl border border-white/5 relative overflow-hidden group">
                                    <h3 className="font-bold text-purple-400 mb-4 flex items-center gap-2 text-lg">
                                        <Target size={20} className="fill-purple-500/20" /> ç›®æ¨™åƒ¹è©¦ç®— (Target PE)
                                    </h3>
                                    <div className="space-y-4">
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-xs font-bold text-purple-400 uppercase tracking-wider mb-2">é ä¼°æœªä¾† EPS</label>
                                                <input type="number" name="estimatedEPS" value={inputs.estimatedEPS} onChange={handleInputChange} 
                                                    className="w-full p-3 bg-purple-950/20 border border-purple-500/30 rounded-xl outline-none text-white font-bold text-center focus:bg-purple-950/40 transition-colors" 
                                                    placeholder="Forward EPS"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-xs font-bold text-purple-400 uppercase tracking-wider mb-2">åˆç†æœ¬ç›Šæ¯”</label>
                                                <input type="number" name="targetPE" value={inputs.targetPE} onChange={handleInputChange} 
                                                    className="w-full p-3 bg-purple-950/20 border border-purple-500/30 rounded-xl outline-none text-white font-bold text-center focus:bg-purple-950/40 transition-colors" 
                                                />
                                            </div>
                                        </div>
                                        <div className="text-[10px] text-neutral-500 text-right">
                                            * è¨ˆç®—å…¬å¼ï¼šé ä¼° EPS x åˆç†æœ¬ç›Šæ¯”
                                        </div>
                                    </div>
                                </div>

                                {/* 3. æˆé•·é æ¸¬ (DCF ç”¨) */}
                                <div className="bg-neutral-900/50 backdrop-blur-md p-6 rounded-2xl shadow-xl border border-white/5 relative overflow-hidden group">
                                    <h3 className="font-bold text-amber-400 mb-5 flex items-center gap-2 text-lg">
                                        <TrendingUp size={20} className="fill-amber-500/20" /> æˆé•·å‹•èƒ½å¼•æ“ (DCF)
                                    </h3>
                                    <div className="space-y-5">
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-xs font-bold text-amber-500/80 mb-2">1-5å¹´æˆé•·ç‡ (%)</label>
                                                <input type="number" name="growthRate1_5" value={inputs.growthRate1_5} onChange={handleInputChange} className="w-full p-3 bg-amber-950/20 border border-amber-500/30 rounded-xl outline-none text-white font-bold text-center focus:bg-amber-950/40 transition-colors" />
                                            </div>
                                            <div>
                                                <label className="block text-xs font-bold text-orange-500/80 mb-2">6-10å¹´æˆé•·ç‡ (%)</label>
                                                <input type="number" name="growthRate6_10" value={inputs.growthRate6_10} onChange={handleInputChange} className="w-full p-3 bg-orange-950/20 border border-orange-500/30 rounded-xl outline-none text-white font-bold text-center focus:bg-orange-950/40 transition-colors" />
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-neutral-400 uppercase tracking-wider mb-2">æ°¸çºŒæˆé•·ç‡ (ä¸èƒ½è¶…éGDP)</label>
                                            <input type="number" name="growthRateTerminal" value={inputs.growthRateTerminal} onChange={handleInputChange} className="w-full p-3 bg-black/40 border border-white/10 rounded-xl outline-none text-white font-medium focus:border-neutral-500 transition-all" />
                                        </div>
                                    </div>
                                </div>

                                {/* 4. é¢¨éšªæŠ˜ç¾ */}
                                <div className="bg-neutral-900/50 backdrop-blur-md p-6 rounded-2xl shadow-xl border border-white/5">
                                    <div className="flex justify-between items-center mb-5">
                                        <h3 className="font-bold text-rose-400 text-lg flex items-center gap-2">
                                            <Flame size={20} className="fill-rose-500/20" /> é¢¨éšªå£“åŠ›æ¸¬è©¦
                                        </h3>
                                        <button onClick={() => setShowHelp(!showHelp)} className="text-neutral-500 hover:text-white transition-colors"><HelpCircle size={18}/></button>
                                    </div>
                                    
                                    {showHelp && (
                                        <div className="bg-rose-950/30 border border-rose-500/20 p-3 rounded-lg text-xs text-rose-200 mb-4 leading-relaxed">
                                            æŠ˜ç¾ç‡è¶Šé«˜ = å°é¢¨éšªè¶Šææ‡¼ = è‚¡åƒ¹ä¼°è¶Šä½ã€‚<br/>èè‹±æ“ç›¤æ‰‹é€šå¸¸è¨­å®š 10% ä»¥ä¸Šä½œç‚ºå®‰å…¨é–€æª»ã€‚
                                        </div>
                                    )}

                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-xs font-bold text-neutral-400 uppercase tracking-wider mb-2">æŠ˜ç¾ç‡ (æœŸæœ›å ±é…¬ %)</label>
                                            <div className="relative">
                                                <input type="number" name="discountRate" value={inputs.discountRate} onChange={handleInputChange} className="w-full p-3 bg-black/40 border border-white/10 rounded-xl outline-none text-white font-medium focus:border-rose-500 focus:ring-1 focus:ring-rose-500 transition-all" />
                                                <div className="absolute right-3 top-1/2 -translate-y-1/2 text-xs text-neutral-500">è¶Šé«˜è¶Šä¿å®ˆ</div>
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-neutral-400 uppercase tracking-wider mb-2">å®‰å…¨é‚Šéš› (æ‰“æŠ˜ %)</label>
                                            <input type="number" name="marginOfSafety" value={inputs.marginOfSafety} onChange={handleInputChange} className="w-full p-3 bg-black/40 border border-white/10 rounded-xl outline-none text-white font-medium focus:border-rose-500 transition-all" />
                                        </div>
                                        {!calc.isValid && <p className="text-red-500 text-sm font-bold bg-red-950/50 p-2 rounded border border-red-500/50">âš ï¸ è­¦å‘Šï¼šæŠ˜ç¾ç‡å¿…é ˆå¤§æ–¼æ°¸çºŒæˆé•·ç‡</p>}
                                    </div>
                                </div>

                            </div>

                            {/* å³å´ï¼šæˆ°æƒ…å®¤å„€è¡¨æ¿ */}
                            <div className="lg:col-span-8 space-y-6">
                                
                                {/* A. é›™è»Œä¼°å€¼æ¯”è¼ƒå¡ç‰‡ (æ–°) */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {/* DCF çµæœ */}
                                    <div className="relative rounded-3xl overflow-hidden shadow-2xl border border-white/10 group bg-neutral-900">
                                        <div className="absolute inset-0 bg-gradient-to-br from-amber-900/40 via-black to-black opacity-80"></div>
                                        <div className="relative p-6 text-white h-full flex flex-col justify-between">
                                            <div>
                                                <h2 className="text-amber-200/80 text-xs font-bold tracking-[0.2em] uppercase mb-2 flex items-center gap-2">
                                                    <Zap size={16} className="text-amber-400" />
                                                    DCF çµ•å°ä¼°å€¼
                                                </h2>
                                                <div className="flex items-baseline gap-2">
                                                    <span className="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-b from-white to-neutral-400 drop-shadow-lg">
                                                            {calc.isValid ? `$${formatNum(calc.intrinsicValue)}` : 'Error'}
                                                    </span>
                                                </div>
                                                <div className="mt-2 text-sm text-neutral-400">
                                                    å…§åœ¨åƒ¹å€¼ (Intrinsic Value)
                                                </div>
                                            </div>
                                            
                                            <div className="mt-6 pt-4 border-t border-white/10">
                                                <div className="flex justify-between items-center">
                                                    <span className="text-emerald-400 text-xs font-bold uppercase tracking-wider">è²·é€²ç›®æ¨™</span>
                                                    <span className="text-emerald-300 font-bold text-lg">${formatNum(calc.safetyPrice)}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* PE Target çµæœ (æ–°) */}
                                    <div className="relative rounded-3xl overflow-hidden shadow-2xl border border-white/10 group bg-neutral-900">
                                        <div className="absolute inset-0 bg-gradient-to-br from-purple-900/40 via-black to-black opacity-80"></div>
                                        <div className="relative p-6 text-white h-full flex flex-col justify-between">
                                            <div>
                                                <h2 className="text-purple-200/80 text-xs font-bold tracking-[0.2em] uppercase mb-2 flex items-center gap-2">
                                                    <Target size={16} className="text-purple-400" />
                                                    PE Target ç›¸å°ä¼°å€¼
                                                </h2>
                                                <div className="flex items-baseline gap-2">
                                                    <span className="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-b from-white to-purple-200 drop-shadow-lg">
                                                            {calc.targetPricePE ? `$${formatNum(calc.targetPricePE)}` : '--'}
                                                    </span>
                                                </div>
                                                <div className="mt-2 text-sm text-neutral-400">
                                                    ç›®æ¨™åƒ¹ (Target Price)
                                                </div>
                                            </div>
                                            
                                            <div className="mt-6 pt-4 border-t border-white/10">
                                                 <div className="flex justify-between items-center text-xs text-neutral-400">
                                                    <span>åŸºç¤: é ä¼°EPS ${inputs.estimatedEPS || 0}</span>
                                                    <span>å€æ•¸: {inputs.targetPE}x</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* B. ç›¸å°ä¼°å€¼é›·é” (Multiples Radar) */}
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    {/* PE Ratio */}
                                    <div className="bg-neutral-900/50 backdrop-blur-sm p-4 rounded-2xl border border-white/5 shadow-lg relative overflow-hidden group">
                                        <div className="absolute top-0 right-0 w-16 h-16 bg-blue-500/10 blur-xl rounded-full group-hover:bg-blue-500/20 transition-all"></div>
                                        <div className="text-xs text-neutral-400 font-bold uppercase tracking-wider mb-1">æœ¬ç›Šæ¯” (PE Ratio)</div>
                                        <div className="text-2xl font-bold text-blue-400 mb-1">
                                            {calc.multiples.peRatio ? calc.multiples.peRatio.toFixed(1) + 'x' : '--'}
                                        </div>
                                        <div className="text-[10px] text-neutral-500">
                                            {calc.multiples.peRatio > 25 ? 'ğŸ”¥ å¸‚å ´ç†±åº¦é«˜' : calc.multiples.peRatio < 12 ? 'â„ï¸ å¸‚å ´å†·æ·¡' : 'âš–ï¸ å€é–“åˆç†'}
                                        </div>
                                    </div>

                                    {/* PEG Ratio */}
                                    <div className="bg-neutral-900/50 backdrop-blur-sm p-4 rounded-2xl border border-white/5 shadow-lg relative overflow-hidden group">
                                         <div className={`absolute top-0 right-0 w-16 h-16 blur-xl rounded-full transition-all ${calc.multiples.pegRatio > 0 && calc.multiples.pegRatio < 1 ? 'bg-green-500/20' : 'bg-neutral-500/10'}`}></div>
                                        <div className="text-xs text-neutral-400 font-bold uppercase tracking-wider mb-1 flex items-center gap-1">
                                            æœ¬ç›Šæˆé•·æ¯” (PEG) <span className="text-green-500 text-[9px] border border-green-500/30 px-1 rounded">æˆé•·è‚¡å¿…çœ‹</span>
                                        </div>
                                        <div className={`text-2xl font-bold mb-1 ${calc.multiples.pegRatio > 0 && calc.multiples.pegRatio < 1 ? 'text-green-400' : 'text-neutral-300'}`}>
                                            {calc.multiples.pegRatio ? calc.multiples.pegRatio.toFixed(2) : '--'}
                                        </div>
                                        <div className="text-[10px] text-neutral-500">
                                            {calc.multiples.pegRatio > 0 ? (calc.multiples.pegRatio < 0.8 ? 'ğŸ’ è¶…ç´šä½ä¼°' : calc.multiples.pegRatio < 1.2 ? 'âœ… åƒ¹æ ¼åˆç†' : 'âš ï¸ æˆé•·è·Ÿä¸ä¸Šè‚¡åƒ¹') : 'éœ€è¼¸å…¥è‚¡åƒ¹èˆ‡æˆé•·ç‡'}
                                        </div>
                                    </div>

                                    {/* PB Ratio */}
                                    <div className="bg-neutral-900/50 backdrop-blur-sm p-4 rounded-2xl border border-white/5 shadow-lg relative overflow-hidden group">
                                        <div className="absolute top-0 right-0 w-16 h-16 bg-purple-500/10 blur-xl rounded-full group-hover:bg-purple-500/20 transition-all"></div>
                                        <div className="text-xs text-neutral-400 font-bold uppercase tracking-wider mb-1">è‚¡åƒ¹æ·¨å€¼æ¯” (PB Ratio)</div>
                                        <div className="text-2xl font-bold text-purple-400 mb-1">
                                            {calc.multiples.pbRatio ? calc.multiples.pbRatio.toFixed(2) + 'x' : '--'}
                                        </div>
                                        <div className="text-[10px] text-neutral-500">
                                            {calc.multiples.pbRatio > 0 ? (calc.multiples.pbRatio < 1 ? 'ğŸ“‰ è·Œç ´æ·¨å€¼' : 'ğŸ“Š è³‡ç”¢è©•åƒ¹') : 'éœ€è¼¸å…¥æ·¨å€¼'}
                                        </div>
                                    </div>
                                </div>

                                {/* C. æˆ°æƒ…åˆ†æ */}
                                <div className="bg-neutral-900/80 backdrop-blur-sm p-6 rounded-2xl border border-blue-500/20 shadow-[0_0_20px_rgba(59,130,246,0.05)]">
                                    <h3 className="font-bold text-blue-400 mb-4 flex items-center gap-2 uppercase tracking-wider text-sm">
                                        <Info size={18}/>
                                        å…¨æ–¹ä½ä¼°å€¼æª¢æ¸¬
                                    </h3>
                                    <div className="space-y-4 text-sm text-neutral-300 leading-relaxed font-light">
                                        <p className="flex gap-3">
                                            <span className="flex-shrink-0 w-6 h-6 rounded bg-blue-500/20 text-blue-400 flex items-center justify-center font-bold text-xs border border-blue-500/30">DCF</span>
                                            <span>
                                                çµ•å°ä¼°å€¼ï¼šæ ¹æ“šç¾é‡‘æµæŠ˜ç¾ï¼Œåˆç†åƒ¹æ ¼ç‚º <strong className="text-white">${formatNum(calc.intrinsicValue)}</strong>ã€‚
                                                {inputs.currentPrice && calc.intrinsicValue > 0 && (
                                                    <span className={`ml-2 font-bold ${inputs.currentPrice < calc.intrinsicValue ? 'text-green-400' : 'text-red-400'}`}>
                                                        (ç›®å‰å¸‚åƒ¹ {inputs.currentPrice < calc.intrinsicValue ? 'ä½æ–¼' : 'é«˜æ–¼'} ä¼°å€¼ {Math.abs((inputs.currentPrice - calc.intrinsicValue)/calc.intrinsicValue*100).toFixed(0)}%)
                                                    </span>
                                                )}
                                            </span>
                                        </p>
                                        <p className="flex gap-3">
                                            <span className="flex-shrink-0 w-6 h-6 rounded bg-purple-500/20 text-purple-400 flex items-center justify-center font-bold text-xs border border-purple-500/30">Target</span>
                                            <span>
                                                ç›®æ¨™åƒ¹ä¼°ç®—ï¼šè‹¥æ˜å¹´è³º <strong className="text-purple-400">${inputs.estimatedEPS || 0}</strong> ä¸”å¸‚å ´çµ¦äºˆ <strong className="text-purple-400">{inputs.targetPE}å€</strong> æœ¬ç›Šæ¯”ï¼Œç›®æ¨™åƒ¹ç‚º <strong className="text-white">${formatNum(calc.targetPricePE)}</strong>ã€‚
                                            </span>
                                        </p>
                                    </div>
                                </div>

                                {/* D. ç¾é‡‘æµæ˜ç´°è¡¨ */}
                                <div className="bg-neutral-900 rounded-2xl border border-white/5 overflow-hidden shadow-xl">
                                    <div className="bg-neutral-800/50 px-6 py-4 border-b border-white/5 flex items-center gap-2">
                                        <Table size={18} className="text-neutral-400" />
                                        <h3 className="font-bold text-neutral-200">ç¾é‡‘æµæŠ˜ç¾æ˜ç´° (DCF Breakdown)</h3>
                                    </div>
                                    
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-sm text-left text-neutral-400">
                                            <thead className="bg-black/20 text-neutral-500 uppercase tracking-wider text-xs font-bold">
                                                <tr>
                                                    <th className="px-6 py-4">Timeline</th>
                                                    <th className="px-6 py-4 text-right">é ä¼° EPS (æœªæŠ˜ç¾)</th>
                                                    <th className="px-6 py-4 text-right">æŠ˜ç¾ä¿‚æ•¸</th>
                                                    <th className="px-6 py-4 text-right text-white">æŠ˜ç¾å¾Œç¾å€¼ (PV)</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-white/5">
                                                {calc.tableData.map((row) => (
                                                    <tr key={row.year} className="hover:bg-white/5 transition-colors group">
                                                        <td className="px-6 py-4 font-medium text-neutral-300">
                                                            <div className="flex items-center gap-2">
                                                                <span className="bg-neutral-800 text-neutral-500 text-[10px] px-1.5 py-0.5 rounded border border-white/5">Y{row.year}</span>
                                                                <span className={row.year <= 5 ? "text-amber-500/80" : "text-orange-500/80"}>{row.stage}</span>
                                                            </div>
                                                        </td>
                                                        <td className="px-6 py-4 text-right font-mono group-hover:text-white transition-colors">${formatNum(row.projectedValue)}</td>
                                                        <td className="px-6 py-4 text-right text-neutral-600 font-mono">{row.discountFactor.toFixed(3)}</td>
                                                        <td className="px-6 py-4 text-right font-bold text-emerald-400 font-mono text-base shadow-[0_0_15px_rgba(52,211,153,0)] group-hover:shadow-[0_0_15px_rgba(52,211,153,0.1)] transition-all">
                                                            ${formatNum(row.presentValue)}
                                                        </td>
                                                    </tr>
                                                ))}
                                                
                                                {/* æ°¸çºŒåƒ¹å€¼åˆ— */}
                                                <tr className="bg-rose-950/10 border-t border-rose-900/30">
                                                    <td className="px-6 py-5">
                                                        <div className="flex flex-col">
                                                            <span className="font-bold text-rose-400 flex items-center gap-2">
                                                                <Crown size={14} /> çµ‚å€¼ (Terminal Value)
                                                            </span>
                                                            <span className="text-[10px] text-rose-500/70 mt-1">æ°¸çºŒæˆé•· {inputs.growthRateTerminal}%</span>
                                                        </div>
                                                    </td>
                                                    <td className="px-6 py-5 text-right text-rose-300/50 font-mono">${formatNum(calc.terminalValue)}</td>
                                                    <td className="px-6 py-5 text-right text-neutral-600 font-mono">{(1 / Math.pow((1 + inputs.discountRate/100), 10)).toFixed(3)}</td>
                                                    <td className="px-6 py-5 text-right font-bold text-rose-400 text-lg font-mono glow-text">
                                                        ${formatNum(calc.terminalValuePV)}
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TwoStageDCF />);
    </script>
</body>
</html>
